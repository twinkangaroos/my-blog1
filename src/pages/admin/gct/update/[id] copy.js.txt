import '@aws-amplify/ui-react/styles.css';
import { useRouter } from 'next/router'
import { DataStore, SortDirection } from '@aws-amplify/datastore';
import { GctNews, GctNewsList } from '../../../../models';
import { useState, useEffect } from 'react';
import { View, Flex, Button, useTheme, Link, Image, Table, TableHead, TableRow, TableCell, TableBody } from '@aws-amplify/ui-react';
import { useRef } from 'react';
import { Authenticator } from '@aws-amplify/ui-react';
import HeaderAdmin from "../../../HeaderAdmin";
//import ImageUploader from '../../../../utils/ImageUploader';
import { Storage } from 'aws-amplify';

const GctNewsDetail = () => {
    const [gctNews, setGctNews] = useState("")
    const [gctNewsList, setGctNewsList] = useState([])
    const [id, setId] = useState("") // パラメータのIDを親IDとして保存
    
    const [focusOnNextAdd, setFocusOnNextAdd] = useState(true); // 要素追加時にフォーカスを当てるかのフラグ
    const [contents, setContents] = useState(['']); // 各要素のvalueを保持する配列（移動時に必要。Modelは書き込み不可のため）
    const divRefs = useRef([]); // contenteditableの参照を保持する配列
    
    const titleRef = useRef(null) // title要素のrefを作成
    const showDateRef = useRef(null)
    
    const [selectedFile, setSelectedFile] = useState(null);


    // パスパラメータからidを取得
    const router = useRouter()
    const param_id = router.query.id
    const { tokens } = useTheme()

    // 初期ロード時の処理
    useEffect(() => {
        doInit()
    }, [param_id])

    // 要素追加時
    useEffect(() => {
        if (focusOnNextAdd && divRefs.current.length > 0) {
            // 新しく追加された要素にフォーカスを当てる
            if (divRefs.current[divRefs.current.length - 1]) {
                divRefs.current[divRefs.current.length - 1].focus()
                setFocusOnNextAdd(false) // フォーカスを当てるフラグをfalseに設定
            }
        }
    }, [focusOnNextAdd, gctNewsList])
    
    // 初期処理
    async function doInit() {
        if (param_id) {
            setId(param_id)
            // GctNews取得
            const gctNewsResult = await DataStore.query(GctNews, (c) => c.id.eq(param_id))
            if (gctNewsResult && gctNewsResult.length > 0) {
                setGctNews(gctNewsResult[0])
                console.log("First success in taking GctNews.", gctNewsResult[0])

                // GctNewsList取得
                const gctNewsListResult = await DataStore.query(GctNewsList, (c) => c.gct_news_id.eq(param_id), {
                    sort:(s) => s.sort(SortDirection.ASCENDING),
                })
                if (gctNewsListResult && gctNewsListResult.length > 0) {
                    // Model形式で保持（例：[0]Model {id: '', ..} [1]Model {id: '', ..}）
                    setGctNewsList(gctNewsListResult)
                    // DBのgctNewsListをテキストで保持
                    const updatedContents = gctNewsListResult.map(item => item.content)
                    setContents(updatedContents)
                    console.log("First success in taking GctNewsList.")
                }

                // メイン画像の取得
                //try {
                //    const image_file = await Storage.get(recipe_result[0].main_image)
                //    setMainImagePath(image_file)
                //}
                //catch (error) {
                //    console.error('Error fetchImage:', error);
                //}
                // DB更新に備えて初期セット
                //setMainImage(recipe_result[0].main_image)

                
            } else {
                console.log("Error when retrieving DB during doInit().....")
            }
        }
    }

    // TODO:配列ごとに保持要
    // ファイル選択時
    const handleFileChange = (e) => {
        const selectFile = e.target.files[0];
        console.log("selectFile", selectFile);
        setSelectedFile(selectFile);
    }

    // ファイルアップロード時
    const handleFileUpload = async (index) => {
        console.log("selectedFile", selectedFile)
        if (selectedFile) {
            try {
                const imageFile = await Storage.put(selectedFile.name, selectedFile); // ファイルのアップロード
                console.log("imageFile", imageFile)
                console.log('アップロードが成功しました');

                const imagePath = await Storage.get(selectedFile.name)
                console.log("imagePath", imagePath)

                const updatedContents = [...contents]; // コピーを作成
                //updatedContents[index] = selectedFile.name; // 配列にファイル名を格納
                updatedContents[index] = imagePath  // 配列にファイルパスを格納
                setContents(updatedContents); // 配列を更新
            } catch (error) {
                console.error('アップロードエラー:', error);
            }
        }
    }

    
    // 更新ボタンクリック
    const onUClick = async (e) => {
        e.preventDefault()
        try {
            if (id) {
                if (!titleRef.current.innerText) {
                    alert("タイトルを入力してください")
                    return
                }
                
                const updatedTitle = titleRef.current.innerText
                const currentDate = new Date() // 2023-08-09T09:02:09.955Z
                // AWSDate 形式に変換
                const awsDate = currentDate.toISOString().split('T')[0]
                
                // gctNews再取得
                const currentGctNews = await DataStore.query(GctNews, (c) => c.id.eq(id))
                if (currentGctNews && currentGctNews.length > 0) {
                    console.log("Success in taking GctNews immediately.", currentGctNews[0])
                    
                    // GctNewsの更新
                    const updatedGctNews = await DataStore.save(
                        GctNews.copyOf(
                            currentGctNews[0], 
                            updated => {
                                updated.title = updatedTitle
                                updated.show_date = awsDate
                            }
                        )
                    )
                    console.log("GctNews successfully updated.")
                } else {
                    console.log("Error when retrieving GctNews before Updated.....")
                    return
                }
                
                // GctNewsListの全削除（※gct_news_idで一括削除するとトランザクションがおかしくなる？）
                await DataStore.delete(GctNewsList, (gctNewsList) => gctNewsList.gct_news_id.eq(id))
                console.log("All GctNewsList successfully deleted.")
                
                // GctNewsListの再作成
                if (gctNewsList && gctNewsList.length > 0) {
                    // TODO: contentsを利用すればよいはず？
                    // contenteditableの内容を取得（※追加したてのnullの考慮要）
                    const updatedContent = gctNewsList.map((_pl, index) => {
                        if (_pl.type == "img") {
                            console.log("_pl.type", _pl.type)
                            console.log("contents", contents[index])
                            return contents[index] ? contents[index] : ''
                        } else {
                            const el = divRefs.current[index];
                            return el ? el.innerText : '';
                        }
                        
                    })
                    
                    // TODO: 段落が多くなれば途中で処理が切れてしまう？
                    // GctNewsListの再作成
                    let i = 0
                    for (const pl of gctNewsList) {
                        const updatedContentValue = updatedContent[i] // 更新後のcontentの値を取得
                        console.log("updatedContentValue", updatedContentValue)
                        await DataStore.save(
                            new GctNewsList({
                                "content": updatedContentValue,
                                "type": pl.type,
                                "sort": i,
                                "gct_news_id": id,
                            })
                        )
                        i++
                    }
                    console.log("All GctNewsList successfully created.")
                }

                // GctNews再取得（※この時点で取得してもうまくいかない模様）
                const r_result = await DataStore.query(GctNews, (c) => c.id.eq(id))
                if (r_result && r_result.length > 0) {
                    setGctNews(r_result[0])
                    console.log("Success in taking GctNews again.", r_result[0])
                } else {
                    console.log("Error when retrieving GctNews after Updated.....")
                    return
                }
                
                alert("更新完了しました。")
            } else {
                console.log("記事が見つかりません")
                return
            }
        }
        catch (error) {
            console.error('更新時にエラーが発生しました:', error);
        }
    }

    
    // 要素追加時（段落（div）・h2大見出し（h3）・h3小見出し（h4））
    const handleAddElement = (tag_type) => {
        setGctNewsList((prevList) => [...prevList, new GctNewsList({ content: '', type: tag_type })]); // gctNewsListに要素を追加
        setContents([...contents, ''])
        setFocusOnNextAdd(true); // フォーカスを当てるフラグをtrueに設定
    }

    // エンターキーを無効化
    const handleKeyDownEnter = (e) => {
        if (e.key === 'Enter') {
            e.preventDefault(); // Enterキーのデフォルトの改行処理を防ぐ
        }
    }

    // 文字がない状態でバックスペース → 要素を削除
    const handleKeyDown = (e, index) => {
        if (e.key === 'Backspace') {
            const el = divRefs.current[index];
            // バックスペースキーが押されたときに内容が空なら要素を削除
            if (el.innerText === '') {
                setGctNewsList(prevList => prevList.filter((_, i) => i !== index));
                // contentsの要素も削除
                setContents(prevContents => prevContents.filter((_, i) => i !== index));
            }
        }
    }

    

    return (
        <Authenticator.Provider>
        <HeaderAdmin />
        <Authenticator hideSignUp={true}>
        {({ signOut, user }) => ( 
        <>
            <View
                backgroundColor={tokens.colors.background.secondary}
                padding={tokens.space.medium}
            >
                <Flex
                    justifyContent="flex-end"
                    style={{
                        paddingBottom: '20px',
                        position: 'sticky',
                        top: 0, // 画面上部からの位置を指定します
                        zIndex: 1, // 必要に応じてz-indexを調整します
                    }}
                >
                    <Button variation="link" size="large"><Link href="/admin/gctnewslist">一覧に戻る</Link></Button>
                    {
                        gctNews ?
                        <Button variation="warning" onClick={onUClick} size="large">更新する</Button>
                        :
                        ''
                    }
                </Flex>
                
                <header id="header">
                    <div className="wrapper">
                        <p className="header-logos">
                            <img src="/gc-t.jp/wp-content/themes/gctrenew2017/images/header.png" alt="" id="img_header_logo" />
                        </p>
                    </div>
                    
                    <label className="hamburger hamburger--squeeze js-hamburger" htmlFor="hamburger-check">
                        <span className="hamburger-box">
                            <span className="hamburger-inner"></span>
                        </span>
                    </label>
                    <div id="searchbox" className="sp-hidden">
                        <form role="search" method="get" id="searchform" className="searchform" action="https://gc-t.jp/">
                            <input type="text" defaultValue="" name="s" id="s" placeholder="サイト内検索" />
                            <input type="submit" id="searchsubmit" defaultValue="検索" />
                        </form>
                    </div>

                    <div id="header-menu-box">
                        <nav id="toc">
                            <h1>MENU</h1>
                            <div id="navi-wrapper">
                                <div id="searchbox" className="sp-only">
                                    <form role="search" method="get" id="searchform" className="searchform" action="https://gc-t.jp/">
                                        <input defaultValue="" name="s" id="s" placeholder="サイト内検索" type="text" />
                                        <input id="searchsubmit" defaultValue="検索" type="submit" />
                                    </form>
                                </div>
                                <div>
                                    <ul id="navi">
                                        <li>
                                            <span className="navi-toggle">TOEFL&reg;<br className="sp-none" />の概要</span>
                                            <ul className="navi-sub">
                                                <li><span className="navi-toggle sp-only">TOEFL&reg;について</span>
                                                    <ul className="navi-sub2">
                                                        <li><a href="https://gc-t.jp/about_test/toefl/" className="navi-link">TOEFL&reg;について</a></li>
                                                        <li><a href="https://gc-t.jp/about_test/introduction_video/" className="navi-link">TOEFL&reg;紹介動画</a></li>
                                                        <li><a href="https://gc-t.jp/about_test/special_interview/" className="navi-link">ETSスペシャルインタビュー</a></li>
                                                        <li><a href="https://gc-t.jp/group/reports_for_educators/" className="navi-link">教育関係者向けレポート</a></li>
                                                    </ul>
                                                </li>

                                                <li><span className="navi-toggle">TOEFL Primary&reg;</span>
                                                    <ul className="navi-sub2">
                                                        <li><a href="https://gc-t.jp/about_test/primary/" className="navi-link">TOEFL
                                                                Primary&reg; Step 1・Step 2 とは</a></li>
                                                        <li><a href="https://gc-t.jp/about_test/primary_test/"
                                                                className="navi-link sp-indent">テスト内容</a></li>
                                                        <li><a href="https://gc-t.jp/about_test/primary_sample/"
                                                                className="navi-link sp-indent">サンプルテスト</a></li>
                                                        <li><a href="https://gc-t.jp/about_test/primary_result/"
                                                                className="navi-link sp-indent">テスト結果</a></li>
                                                        
                                                        <li><a href="https://gc-t.jp/about_test/primary_voice/"
                                                                className="navi-link sp-indent">ユーザーの声</a></li><br className="sp-none" />
                                                        <li className="exceptional speaking_blue"><a
                                                                href="https://gc-t.jp/about_test/primary_speaking_description/"
                                                                className="navi-link">TOEFL Primary&reg; Speakingとは</a></li>
                                                        <li className="speaking_blue"><a
                                                                href="https://gc-t.jp/about_test/primary_speaking_test/"
                                                                className="navi-link sp-indent">テスト内容</a></li>
                                                        <li className="speaking_blue"><a
                                                                href="https://gc-t.jp/about_test/primary_speaking_sample/"
                                                                className="navi-link sp-indent">サンプル（動画・音声）</a></li>
                                                        <li className="speaking_blue"><a
                                                                href="https://gc-t.jp/about_test/primary_speaking_rubric/"
                                                                className="navi-link sp-indent">Rubric（評価基準）・スコアレベル</a></li>
                                                        <li className="speaking_blue"><a
                                                                href="https://gc-t.jp/about_test/primary_speaking_result/"
                                                                className="navi-link sp-indent">テスト結果</a></li>
                                                    </ul>
                                                </li>
                                                <li><span className="navi-toggle">TOEFL Junior&reg;</span>
                                                    <ul className="navi-sub2">
                                                        <li><a href="https://gc-t.jp/about_test/junior/" className="navi-link">TOEFL
                                                                Junior&reg; Standardとは</a></li>
                                                        <li><a href="https://gc-t.jp/about_test/junior_test/"
                                                                className="navi-link sp-indent">テスト内容</a></li>
                                                        <li><a href="https://gc-t.jp/about_test/junior_sample/"
                                                                className="navi-link sp-indent">サンプルテスト</a></li>
                                                        <li><a href="https://gc-t.jp/about_test/junior_result/"
                                                                className="navi-link sp-indent">テスト結果</a></li>
                                                        
                                                        <li><a href="https://gc-t.jp/about_test/junior_voice/"
                                                                className="navi-link sp-indent">ユーザーの声</a></li><br className="sp-none" />
                                                        <li className="exceptional speaking_blue"><a
                                                                href="https://gc-t.jp/about_test/junior_speaking_description/"
                                                                className="navi-link">TOEFL Junior&reg; Speakingとは</a></li>
                                                        <li className="speaking_blue"><a
                                                                href="https://gc-t.jp/about_test/junior_speaking_test/"
                                                                className="navi-link sp-indent">テスト内容</a></li>
                                                        <li className="speaking_blue"><a
                                                                href="https://gc-t.jp/about_test/junior_speaking_sample/"
                                                                className="navi-link sp-indent">サンプル（画像・音声）</a></li>
                                                        <li className="speaking_blue"><a
                                                                href="https://gc-t.jp/about_test/junior_speaking_rubric/"
                                                                className="navi-link sp-indent">Rubric（評価基準）・スコア</a></li>
                                                        <li className="speaking_blue"><a
                                                                href="https://gc-t.jp/about_test/junior_speaking_result/"
                                                                className="navi-link sp-indent">テスト結果</a></li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </li>
                                        <li>
                                            <span className="navi-toggle">受験者<br className="sp-none" />の方へ</span>
                                            <ul className="navi-sub">
                                                <li>
                                                    <span className="navi-toggle">個人で受験される方</span>
                                                    <ul className="navi-sub2">
                                                        <li className="speaking_blue"><a href="https://gc-t.jp/test/personal/"
                                                                className="navi-link">個人で受験される方（Listening &amp; Reading）</a></li>
                                                        <li className="speaking_blue"><a href="https://gc-t.jp/test/personal_speaking/"
                                                                className="navi-link">個人で受験される方（Speaking）</a></li>
                                                        <br className="sp-none" />
                                                        <li className="exceptional"><a href="https://gc-t.jp/test/primary_list/"
                                                                className="navi-link">TOEFL Primary&reg; Step 1・Step 2 テスト日程とお申し込み</a>
                                                        </li>
                                                        <li className="speaking_blue"><a
                                                                href="https://gc-t.jp/test/primary_speaking_list/"
                                                                className="navi-link">TOEFL Primary&reg; Speaking テスト日程とお申し込み</a></li>
                                                        <br className="sp-none" />
                                                        <li className="exceptional"><a href="https://gc-t.jp/test/junior_list/"
                                                                className="navi-link">TOEFL Junior&reg; Standardテスト日程とお申し込み</a></li>
                                                        <li className="speaking_blue"><a
                                                                href="https://gc-t.jp/test/junior_speaking_list/"
                                                                className="navi-link">TOEFL Junior&reg; Speaking テスト日程とお申し込み</a></li>
                                                        <br className="sp-none" />
                                                    </ul>
                                                </li>
                                                <li><span className="navi-toggle">団体で受験される方</span>
                                                    <ul className="navi-sub2">
                                                        <li><a href="https://gc-t.jp/test/group/"
                                                                className="navi-link">団体で受験される方（Listening &amp; Reading）</a></li>
                                                        <li className="speaking_blue"><a href="https://gc-t.jp/test/speaking_group/"
                                                                className="navi-link">団体で受験される方（Speaking）</a></li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </li>
                                        <li>
                                            <span className="navi-toggle">学習<br className="sp-none" />サポート</span>
                                            <ul className="navi-sub">
                                                <li><a href="https://gc-t.jp/support/materials/" className="navi-link">問題集</a></li>
                                                <li><a href="https://gc-t.jp/support/online_learning/" className="navi-link">オンライン学習</a></li>
                                                <li><a href="https://gc-t.jp/support/lexile/" className="navi-link">Lexile&reg;指数</a></li>
                                                <li><a href="https://gc-t.jp/support/high-scores/" className="navi-link">ハイスコア受験者情報</a></li>
                                            </ul>
                                        </li>
                                        <li>
                                            <span className="navi-toggle">入試活用<br className="sp-none" />海外情報</span>
                                            <ul className="navi-sub">
                                                <li><a href="https://gc-t.jp/use_score/utilization_of_score/"
                                                        className="navi-link">スコアの活用</a></li>
                                                <li><a href="https://gc-t.jp/world/over_sea/" className="navi-link">世界での広がり</a></li>
                                            </ul>
                                        </li>
                                        <li>
                                            <span className="navi-toggle">学校・団体<br className="sp-none" />の方へ</span>
                                            <ul className="navi-sub">
                                                <li><a href="https://gc-t.jp/group/introduction/" className="navi-link">導入のメリット</a></li>
                                                <li><a href="https://gc-t.jp/group/administered/"
                                                        className="navi-link">団体実施について（Listening &amp; Reading）</a></li>
                                                <li><a href="https://gc-t.jp/group/cbt_administered/"
                                                        className="navi-link">団体実施について（Listening &amp; Reading CBT）</a></li>
                                                <li><a href="https://gc-t.jp/group/speaking_administered/"
                                                        className="navi-link">団体実施について（Speaking）</a></li>
                                                <li><a href="https://gc-t.jp/group/reports_for_educators/"
                                                        className="navi-link">教育関係者向けレポート</a></li>
                                            </ul>
                                        </li>
                                        <li>
                                            <span className="navi-toggle oneline">活用事例</span>
                                            <ul className="navi-sub">
                                                <li><a href="https://gc-t.jp/group/case_example/" className="navi-link">活用事例</a></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div id="misc-wrapper">
                                <div>
                                    <div id="misc">
                                        <ul>
                                            <li className="sp-hidden"><a href="javasscript:void(0);" className="search"
                                                    id="lnk_searchbox_toggle"><Image
                                                    src="/gc-t.jp/wp-content/themes/gctrenew2017/images/icon/search.png" /></a>
                                            </li>
                                            <li className="sp-only"><a href="https://gc-t.jp/news/" className="navi-link">ニュース</a></li>
                                            <li><a href="https://gc-t.jp/inquiry/" className="navi-link">お問い合わせ</a></li>
                                            <li className="sp-only"><a href="https://gc-t.jp/company/" className="navi-link">会社情報</a></li>
                                            <li><a href="https://gc-t.jp/faq/" className="navi-link">よくある質問</a></li>
                                            <li className="sp-hidden"><a href="https://gc-t.jp/news/" className="navi-link">ニュース</a></li>
                                            <li><a href="https://gc-t.jp/en/" className="navi-link">English</a></li>
                                            <li className="sp-only"><a href="https://gc-t.jp/privacy/" className="navi-link">プライバシーポリシー</a></li>
                                            <li className="sp-only"><a href="https://gc-t.jp/policy/" className="navi-link">サイトポリシー</a></li>
                                        </ul>
                                        <div className="login-link"><a href="https://gc-t.jp/member/" className="navi-link">ログイン</a></div>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                </header>
                <div id="main-image">
                    <div id="breadcrumbs-wrapper">
                        <div className="wrapper">
                            <ul id="breadcrumbs">
                                <li><a href="https://gc-t.jp/">HOME</a></li>
                                <li><a href="https://gc-t.jp/news/category/case">導入事例</a></li>
                                <li>「英語学習ミニセミナー＆オンライン座談会」実施レポート</li>
                            </ul>
                        </div>
                    </div>
                    <img src="/gc-t.jp/wp-content/uploads/2017/09/news_main-1.jpg" />
                </div>

                {/* --------------------  main -------------------- */}
                <main>
                    <div className="wrapper">
                        <div className="content">
                            <header>
                                {
                                    gctNews ?
                                    <h1
                                        contentEditable
                                        dangerouslySetInnerHTML={{ __html: gctNews && gctNews.title ? gctNews.title : '' }}
                                        ref={titleRef} // refをtitle要素に紐付け
                                        onKeyDown={handleKeyDownEnter} // Enterキーの処理を行う
                                        placeholder="「英語学習ミニセミナー＆オンライン座談会」実施レポート"
                                        className='is-large'
                                    />
                                    : "DB取得に失敗しました。"
                                }
                            </header>
                            <div className="news-detail-info">
                                <div>
                                    <span className="cat-tip cat-case">導入事例</span>
                                    <div
                                        contentEditable
                                        dangerouslySetInnerHTML={{ __html: gctNews && gctNews.show_date ? gctNews.show_date : '' }}
                                        ref={showDateRef}
                                        onKeyDown={handleKeyDownEnter}
                                        style={{ float: "right" }}
                                    />
                                </div>
                                <ul className="tags">
                                    <li><span>TOEFL Primary®</span></li>
                                    <li><span>TOEFL Junior®</span></li>
                                    <li><span>イベント</span></li>
                                    <li><span>活用者インタビュー</span></li>
                                </ul>
                                <div style={{ margin: "5px 0", display: "none" }}>
                                    <a href="https://twitter.com/TOEFL_GCT?ref_src=twsrc%5Etfw" className="twitter-follow-button"
                                        data-show-count="false" data-lang="ja">Follow</a>
                                    <a href="https://twitter.com/share" className="twitter-share-button"
                                        data-text="「英語学習ミニセミナー＆オンライン座談会」実施レポート" data-url="https://gc-t.jp/news/case/8298/"
                                        data-lang="ja">Tweet</a>
                                </div>
                            </div>
                            
                            {/* --------------------  list -------------------- */}
                            <div className="news-detail-entry">
                                <p style={{ lineHeight: "2" }}>
                                    コロナ禍における新しいイベントの一つとして「英語学習ミニセミナー＆オンライン座談会」が、2021年3月に開催されました。小学生のお子様のいる保護者を中心に、英語学習に関心が高い方々が参加され、オンラインによる双方向の情報交換が行われました。イベント主催の株式会社キャリア・マム　葛山みずほ様にお話を伺いながら、当日の模様をレポートいたします。
                                </p>
                                
                                <figure className="right_lca fr">
                                    <img className="sp-none" src="/gc-t.jp/wp-content/uploads/2021/03/cm_report_img1.jpg"
                                        width="350" />
                                </figure>
                                <div style={{ lineHeight: "2" }}>
                                    株式会社キャリア・マム<br />
                                    女性のためのキャリア支援事業を中心に「働く女性のためのアウトソーシング事業」、「働く女性のニーズを活かしたマーケティング事業」、「在宅ワーカー育成事業」、「託児つきコワーキングスペースの運営」など多岐にわたるビジネスを展開。会員登録者は国内外含め10万人にのぼる。<br />
                                    マーケティング事業やキャリア支援事業で培ったノウハウで、オンラインを活用したさまざまなイベントの企画運営も手掛ける。
                                </div>
                                
                                <h3 className="mt2">英語学習ミニセミナー＆オンライン座談会</h3>
                                <h3 className="nakamuraschool_pt pt0" style={{ textIndent: "1em"}}>■ミニセミナー、Q&Aタイム</h3>
                                
                                <figure className="right fr">
                                    <img className="sp-none" src="/gc-t.jp/wp-content/uploads/2021/03/cm_report_img2-.jpg"
                                        width="200" />
                                    <figcaption>AEA代表理事　赤井由紀子様</figcaption>
                                </figure>
                                <div style={{ lineHeight: "2" }}>
                                    <p>地域の子どもたちとともに国際交流の機会を企画実践する活動を推進するNPO法人All Education
                                        Academy（AEA）代表理事の赤井由紀子様に、子どもたちを取り巻く英語教育環境の変化、家庭での英語学習のポイントやおすすめのアプローチ方法についてお話いただきました。
                                    </p>
                                    <div style={{ textIndent: "-1em", paddingLeft: "2em" }}>〇小学生からの英語の教科化…文科省に経産省も加わった、国を挙げての教育改革
                                    </div>
                                    <div style={{ textIndent: "-1em", paddingLeft: "2em" }}>
                                        〇実社会で必要とされるスキル…「思考力」「判断力」「表現力」　受験英語へ波及する影響と対応</div>
                                    <div style={{ textIndent: "-1em", paddingLeft: "2em" }}>
                                        〇家庭教育のポイント…英語力はReading量に比例。親子で楽しみながらチャレンジしたいReading力の基礎づくり</div>
                                </div>
                                
                                <h4 style={{ clear: "both" }}>葛山様より：</h4>
                                
                                <figure className="right fr">
                                    <img src="/gc-t.jp/wp-content/uploads/2021/03/cm_report_img3.jpg" width="250" />
                                    <figcaption>株式会社キャリア・マム<br />葛山みずほ様</figcaption>
                                </figure>
                                
                                <div className="left" style={{ lineHeight: "2" }}>
                                    赤井由紀子様のお話は、印象的なキーワードがわかりやすく伝わるものだったと思います。新学習指導要領の改訂について身近な事例で教えていただき、社会に対応できる人材育成が求められているとわかりました。英語力においては多様な経験、価値観に触れることがますます重要となり、そのためのアプローチのひとつとして、今回のミニセミナーでは「読む力を高める」という家庭学習のポイントをご紹介いただきました。<br />
                                    私自身、６才の子どもの母親として、親子で楽しみながら本に触れることを心がけています。寝る前に読み聞かせを続けていますが、赤井様のセミナーを聞き、英語の本も取り入れるようになりました。子どもも楽しんでいる様子で、忙しい毎日の中、親子で英語を楽しむ大切な時間となっています。<br />
                                    赤井様から、家庭での英語学習では発音にこだわるより、親子で同じ時間を通じて楽しむ姿勢が大切というアドバイスをいただけたのもよかったですね。保護者の皆さんも肩の力が抜けたのではないでしょうか。続くQ&Aタイムでも参加者から積極的な発言がいただけて、皆さんが知りたかったことが共有できる有意義な場となりました。
                                </div>
                                
                                <h3 className="nakamuraschool_ptpt" style={{ TextIndent: "1em" }}>■座談会</h3>
                                <div style={{ lineHeight: "2" }}>
                                    この時間帯はZoomのブレイクアウトルーム機能を活用し、少人数のグループに分かれて、日頃の英語学習についての情報交換が行われました。「子どもに楽しく英語に向き合わせるにはどうしたらよいか」といったお悩みに、他の参加者から「うちではこんな風に取り組んでいます」という実践が紹介されるなど、参加者どうしのやり取りも和やかに進みました。
                                </div>

                                <h4>葛山様より：</h4>
                                <div>
                                    <figure className="right fr">
                                        <img className="sp-none" src="/gc-t.jp/wp-content/uploads/2021/03/cm_report_img4.png"
                                            width="350" />
                                    </figure>
                                    <div style={{ lineHeight: "2" }}>
                                        時間の制約がある中でしたが、皆さんに発言いただき、話題を広げていくことを心がけました。英語教育に強い思いをお持ちだけれども、子どもに英語への興味をもたせるにはいろいろとご苦労がある様子は、参加者の皆さんの共通点だったようです。その悩みへの答えに、他の参加者から「わが家も同じだけど、こんな工夫をしている」というお話が出たり、「〇年生になるとだんだんと変化しました」といった、お子さんの年齢差による経験談がきけたり、双方向でやり取りできる形が活かされました。<br />
                                        今回の座談会の目的のひとつとして、即効性ある対処法を学ぶことよりも、英語教育への思いや悩みを参加者自身が話し共有できる場をつくることがありました。そうした第一段階がとても大事だと考えます。その役割を果たせたという手ごたえもあり、参加者の皆さんはきっと、家庭での英語学習の取り組みに関して次のアクションがとりやすくなったかと思います。いろいろな情報を得る中で参加者が試行錯誤し、それぞれの家庭に合ったやり方で取り組んでみることが大切ではないでしょうか。
                                    </div>
                                </div>
                                
                                <h3 className="nakamuraschool_ptpt" style={{ textIndent: "1em" }}>■<i>TOEFL Primary</i>&reg; ご説明</h3>
                                <div style={{ lineHeight: "2" }}>
                                    普段の英語学習の効果測定、実践の場として活用いただける、<i>TOEFL Primary</i>&reg;
                                    について、グローバル・コミュニケーション＆テスティングよりご説明させていただきました。「小学生から始められる<i>TOEFL</i>&reg;
                                    テスト」「小学生にとって身近で興味深い内容で構成されたテストデザイン」「グローバルな指標から現在地をスコアで確認できる信頼性」などの特徴をご紹介しながら、「練習」（＝日頃の英語学習）と「実践」（＝手応えと課題を得るテストの活用）の組み合わせにより、英語学習をさらに充実したものとすることをご提案しました。
                                </div>
                                <h4>葛山様より：</h4>
                                
                                <figure className="right fr">
                                    <img className="sp-none" src="/gc-t.jp/wp-content/uploads/2021/03/cm_report_img5.png"
                                        width="350" />
                                </figure>
                                <div style={{ lineHeight: "2" }}>
                                    <i>TOEFL Primary</i>&reg;
                                    の特徴である、実践的な内容や構成がよくわかりました。英語を使うのはグローバルな場面なので、子どもたちの英語力もグローバル基準で測定できることは大きな魅力です。合格、不合格という結果ではなく、<i>TOEFL
                                        Primary</i>&reg;
                                    のスコアで実力がわかるのはとてもいいですね。赤井様のミニセミナーでも、アジアの中での日本の英語力の低さのお話があり、これからますます「世界基準で英語力を捉えること」は大切になってくると実感しました。その意識からも、<i>TOEFL
                                        Primary</i>&reg; は効果的なオプションの一つになりますね。<br />
                                    英語教育に関心のある、意識の高い方々に、このようなテストの情報を詳しく知っていただけたのはとてもよい機会だったと感じました。また、参加者の中に親子で<i>TOEFL
                                        Primary</i>&reg; を受験したことがあるという方がいらっしゃって、その経験談をお話しいただけたことも、皆さんにとって大変参考になったようです。<br />
                                    今回のミニセミナー＆オンライン座談会は、参加者皆さんの顔が見える形で、双方向に情報のやり取りができる場にすることを心がけました。参加者の方々からも、悩みを共有しつつ、英語学習のモチベーションを上げるヒントがもらえた、といったご感想をいただき、満足していただけた手応えがありました。
                                    <p>オンラインによるこのような場は、開催場所の制約がなく、在宅ワーカーを志向する方々のニーズにも合致するものです。英語学習の低年齢化、ニーズの高まりは言うまでもなく、子どもたちの学習環境のオンライン化もこれから進む中、保護者が教育について考える手段としてのオンラインの存在感、可能性はますます大きくなっていくことを改めて実感する機会になりました。
                                    </p>
                                </div>
                                
                            </div>
                            
                            {
                                gctNewsList.length > 0 ?
                                gctNewsList.map((newsItem, index) => {
                                    // 上に移動ボタン
                                    //const renderUpElement = (index) => {
                                    //    if (index > 0) {
                                    //        return (
                                    //            <Button onClick={() => handleMoveUp(index)} className="amplify-button amplify-field-group__control amplify-button--default amplify-button--small">↑</Button>
                                    //        )
                                    //     } else {
                                    //         return (
                                    //             <Button isDisabled={true} className="amplify-button amplify-field-group__control amplify-button--default amplify-button--small amplify-button--disabled">↑</Button>
                                    //         )
                                    //     }
                                    // }
                                    // // 下に移動ボタン
                                    // const renderDownElement = (index) => {
                                    //     if (index < gctNewsList.length - 1) {
                                    //         return (
                                    //             <Button onClick={() => handleMoveDown(index)} className="amplify-button amplify-field-group__control amplify-button--default amplify-button--small">↓</Button>
                                    //         )
                                    //     } else {
                                    //         return (
                                    //             <Button isDisabled={true} className="amplify-button amplify-field-group__control amplify-button--default amplify-button--small amplify-button--disabled">↓</Button>
                                    //         )
                                    //     }
                                    // }
                                    if (newsItem.type === "div") {
                                        return (
                                            <Flex key={index + "_head"} className="left">
                                                <div
                                                    key={index}
                                                    contentEditable
                                                    style={{ lineHeight: "2", marginTop: "10px", marginBottom: "10px" }}
                                                    className="left"
                                                    dangerouslySetInnerHTML={{ __html: contents[index] ? contents[index].replace(/\n/g, '<br />') : '' }}
                                                    ref={el => (divRefs.current[index] = el)}
                                                    onKeyDown={e => handleKeyDown(e, index)}
                                                />
                                                
                                            </Flex>
                                        )
                                    } else if (newsItem.type === "img") {
                                        {/* TODO：画像を配列に保持する */}
                                        return (
                                            <Flex key={index + "_head"} className="right fr">
                                                <Flex direction="column">
                                                    <figure className="right fr">
                                                        <Image
                                                            key={index}
                                                            className="sp-none"
                                                            src={contents[index]}
                                                            width={200}
                                                        />
                                                    </figure>
                                                    <div>
                                                        <input type="file" key={"file_"+index} onChange={handleFileChange} style={{ fontSize: '9px' }} />
                                                        <Button variation="warning" key={"file_button_"+index} onClick={() => handleFileUpload(index)} size="small" style={{ fontSize: '9px' }}>アップロード</Button>
                                                    </div>
                                                </Flex>
                                            </Flex>
                                        )
                                    } else if (newsItem.type === "h3") {
                                        return (
                                            <Flex key={index + "_head"} direction="row" width={'100%'}>
                                                <h3
                                                    key={index}
                                                    contentEditable
                                                    style={{ TextIndent: "1em" }}
                                                    dangerouslySetInnerHTML={{ __html: contents[index] ? contents[index].replace(/\n/g, '<br />') : '' }}
                                                    ref={el => (divRefs.current[index] = el)}
                                                    onKeyDown={e => handleKeyDown(e, index)}
                                                />
                                                
                                            </Flex>
                                        )
                                    } else if (newsItem.type === "h4") {
                                        return (
                                            <Flex key={index + "_head"} direction="row" width={'100%'}>
                                                <h4
                                                    key={index}
                                                    contentEditable
                                                    //style={{ border: 'none', outline: 'none', lineHeight: '1.5', width: '100%' }}
                                                    dangerouslySetInnerHTML={{ __html: contents[index] ? contents[index].replace(/\n/g, '<br />') : '' }}
                                                    ref={el => (divRefs.current[index] = el)}
                                                    onKeyDown={e => handleKeyDown(e, index)}
                                                />
                                                
                                            </Flex>
                                        )
                                    }
                                })
                                :
                                ''
                            }
                            {
                                gctNews ?
                                <Flex direction="row" alignItems="flex-end" style={{ marginTop: '20px', clear: "both" }}>
                                    <Button variation="default" onClick={() => handleAddElement("h3")} size="large" style={{height: '50px', fontWeight: 'bold'}}>大見出しの追加</Button>
                                    <Button variation="default" onClick={() => handleAddElement("h4")} size="large" style={{height: '40px'}}>小見出しの追加</Button>
                                    <Button variation="default" onClick={() => handleAddElement("div")} size="large" style={{height: '30px'}}>段落の追加</Button>
                                    <Button variation="default" onClick={() => handleAddElement("img")} size="large" style={{height: '30px'}}>画像の追加</Button>
                                </Flex>
                                :
                                'DB取得に失敗しました。'
                            }


                        </div>
                    </div>
                </main>


                
                

                

            </View>
        </>
        )}
        </Authenticator>
        </Authenticator.Provider>
    )
}

export default GctNewsDetail